<div class="container">
  @if (isLoading) {
    <div class="loader-wrapper">
      <div class="bottom triangle"></div>
      <div class="top triangle"></div>
      <div class="left triangle"></div>
      <div class="right triangle"></div>
    </div>
  }

  @if (!isLoading) {
    <mat-card class="transfer-card">
      <mat-card-content>
        <!-- Source Account Details Section -->
        <div class="section-container">
          <h3 class="section-title transfer-heading">{{ 'labels.heading.Transferring From Details' | translate }}</h3>
          <mat-divider></mat-divider>
          <div class="info-grid">
            <div class="info-row">
              <div class="info-label">{{ 'labels.inputs.Applicant' | translate }}</div>
              <div class="info-value">{{ accountTransferTemplateData.fromClient.displayName }}</div>
            </div>
            <div class="info-row">
              <div class="info-label">{{ 'labels.inputs.Office' | translate }}</div>
              <div class="info-value">{{ accountTransferTemplateData.fromOffice.name }}</div>
            </div>
            <div class="info-row">
              <div class="info-label">{{ 'labels.inputs.From Account' | translate }}</div>
              <div class="info-value">
                {{ accountTransferTemplateData.fromAccount.productName }}&nbsp;-&nbsp;#{{
                  accountTransferTemplateData.fromAccount.accountNo
                }}
              </div>
            </div>
            <div class="info-row">
              <div class="info-label">{{ 'labels.inputs.From Account Type' | translate }}</div>
              <div class="info-value">{{ accountTransferTemplateData.fromAccountType.value }}</div>
            </div>
            <div class="info-row">
              <div class="info-label">{{ 'labels.inputs.Currency' | translate }}</div>
              <div class="info-value">{{ accountTransferTemplateData.currency.name }}</div>
            </div>
          </div>
        </div>
        <!-- Interbank Section -->
        @if (interbank) {
          <div class="section-container">
            <div class="interbank-section">
              <h3 class="section-title transfer-heading">{{ 'labels.heading.Transferred To' | translate }}</h3>
              <mat-form-field class="full-width">
                <mat-label>{{ 'labels.inputs.Phone Number' | translate }}</mat-label>
                <input
                  matInput
                  [readonly]="interbankTransferForm"
                  type="tel"
                  #input
                  [(ngModel)]="phoneAccount"
                  maxlength="10"
                  required
                  placeholder="{{ 'labels.text.EnterPhoneNumber' | translate }}"
                  title="Phone number"
                />
                <mat-hint align="end">{{ phoneAccount.length || 0 }}/10</mat-hint>
              </mat-form-field>
            </div>
            <!--interbank -->
            @if (!interbankTransferForm) {
              <mat-card-actions class="action-buttons">
                <ng-container *mifosxHasPermission="'CREATE_ACCOUNTTRANSFER'">
                  <button
                    mat-raised-button
                    color="primary"
                    [disabled]="phoneAccount.length !== 10"
                    (click)="searchAccountByNumber()"
                    id="search-button"
                    class="primary-button"
                  >
                    {{ 'labels.buttons.Search' | translate }}
                  </button>
                </ng-container>
              </mat-card-actions>
            }
          </div>
        }
        @if (!interbank) {
          <mat-divider></mat-divider>
        }
        <!-- Transfer Form Section (Normal) -->
        @if (!interbank && makeAccountTransferForm) {
          <form [formGroup]="makeAccountTransferForm" class="transfer-form">
            <h3 class="section-title transfer-heading">{{ 'labels.heading.Transfer Details' | translate }}</h3>
            <div class="form-grid">
              <mat-form-field class="form-field" (click)="transferDatePicker.open()">
                <mat-label>{{ 'labels.inputs.Transaction Date' | translate }}</mat-label>
                <input
                  matInput
                  [min]="minDate"
                  [max]="maxDate"
                  [matDatepicker]="transferDatePicker"
                  required
                  formControlName="transferDate"
                  placeholder="{{ 'labels.text.SelectDate' | translate }}"
                  title="Transaction Date"
                />
                <mat-datepicker-toggle matSuffix [for]="transferDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #transferDatePicker></mat-datepicker>
                @if (makeAccountTransferForm.controls.transferDate.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Transaction Date' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Office' | translate }}</mat-label>
                <mat-select required formControlName="toOfficeId" (selectionChange)="changeEvent()">
                  @for (toOfficeType of toOfficeTypeData; track toOfficeType) {
                    <mat-option [value]="toOfficeType.id">
                      {{ toOfficeType.name }}
                    </mat-option>
                  }
                </mat-select>
                @if (makeAccountTransferForm.controls.toOfficeId.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Office' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Client' | translate }}</mat-label>
                <input
                  matInput
                  formControlName="toClientId"
                  [matAutocomplete]="clientsAutocomplete"
                  placeholder="{{ 'labels.text.SelectOrTypeClientName' | translate }}"
                  title="Client name"
                />
                @if (makeAccountTransferForm.controls.toClientId.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Client' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
              </mat-form-field>
              <mat-autocomplete
                autoActiveFirstOption
                #clientsAutocomplete="matAutocomplete"
                [displayWith]="displayClient"
              >
                @for (client of clientsData; track client) {
                  <mat-option [value]="client"> {{ client.id }} - {{ client.displayName }} </mat-option>
                }
              </mat-autocomplete>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Account Type' | translate }}</mat-label>
                <mat-select required formControlName="toAccountType" (selectionChange)="changeEvent()">
                  @for (toAccountType of toAccountTypeData; track toAccountType) {
                    <mat-option [value]="toAccountType.id">
                      {{ toAccountType.value }}
                    </mat-option>
                  }
                </mat-select>
                @if (makeAccountTransferForm.controls.toAccountType.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Account Type' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Account' | translate }}</mat-label>
                <mat-select required formControlName="toAccountId" (selectionChange)="changeEvent()">
                  @for (toAccount of toAccountData; track toAccount) {
                    <mat-option [value]="toAccount.id">
                      {{ toAccount.productName }} - {{ toAccount.accountNo }}
                    </mat-option>
                  }
                </mat-select>
                @if (makeAccountTransferForm.controls.toAccountId.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Account' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Amount' | translate }}</mat-label>
                <input
                  type="number"
                  matInput
                  required
                  formControlName="transferAmount"
                  placeholder="{{ 'labels.text.EnterAmount' | translate }}"
                  title="Transfer amount"
                  min="0.01"
                  step="0.01"
                />
                @if (makeAccountTransferForm.controls.transferAmount.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Amount' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
                @if (makeAccountTransferForm.get('transferAmount')?.hasError('amountExceedsBalance')) {
                  <mat-error>
                    <fa-icon icon="exclamation-triangle" size="md"></fa-icon>
                    {{ 'errors.validation.msg.savingsproduct.insufficient.balance' | translate: { balance } }}
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field class="form-field description-field">
                <mat-label>{{ 'labels.inputs.Description' | translate }}</mat-label>
                <textarea
                  matInput
                  formControlName="transferDescription"
                  cdkTextareaAutosize
                  cdkAutosizeMinRows="2"
                  placeholder="{{ 'labels.text.EnterTransferDescription' | translate }}"
                  title="Transfer description"
                ></textarea>
                @if (makeAccountTransferForm.controls.transferDescription.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Transfer Description' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
              </mat-form-field>
            </div>
          </form>
        }
        <!-- Interbank Transfer Form Section -->
        @if (interbank && interbankTransferForm && makeAccountTransferForm) {
          <form [formGroup]="makeAccountTransferForm" class="transfer-form">
            <h3 class="section-title transfer-heading">{{ 'labels.heading.Transfer Details' | translate }}</h3>
            <div class="form-grid">
              <mat-form-field class="form-field" (click)="transferDatePicker.open()">
                <mat-label>{{ 'labels.inputs.Transaction Date' | translate }}</mat-label>
                <input
                  matInput
                  [min]="minDate"
                  [max]="maxDate"
                  [matDatepicker]="transferDatePicker"
                  required
                  formControlName="transferDate"
                  placeholder="{{ 'labels.text.SelectDate' | translate }}"
                  title="Transaction Date"
                />
                <mat-datepicker-toggle matSuffix [for]="transferDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #transferDatePicker></mat-datepicker>
                @if (makeAccountTransferForm.controls.transferDate.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Transaction Date' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Bank' | translate }}</mat-label>
                <input
                  matInput
                  formControlName="toBank"
                  [readonly]="true"
                  placeholder="{{ 'labels.inputs.Bank' | translate }}"
                  title="Bank"
                />
              </mat-form-field>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Client' | translate }}</mat-label>
                <input
                  matInput
                  formControlName="toClientId"
                  [readonly]="true"
                  placeholder="{{ 'labels.inputs.Client' | translate }}"
                  title="Client"
                />
              </mat-form-field>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Account Type' | translate }}</mat-label>
                <input
                  matInput
                  formControlName="toAccountType"
                  [readonly]="true"
                  placeholder="{{ 'labels.inputs.Account Type' | translate }}"
                  title="Account Type"
                />
              </mat-form-field>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Account' | translate }}</mat-label>
                <input
                  matInput
                  formControlName="toAccountId"
                  [readonly]="true"
                  placeholder="{{ 'labels.inputs.Account' | translate }}"
                  title="Account"
                />
              </mat-form-field>
              <mat-form-field class="form-field">
                <mat-label>{{ 'labels.inputs.Amount' | translate }}</mat-label>
                <input
                  type="number"
                  matInput
                  required
                  formControlName="transferAmount"
                  placeholder="{{ 'labels.text.EnterAmount' | translate }}"
                  title="Transfer amount"
                  min="0.01"
                  step="0.01"
                />
                @if (makeAccountTransferForm.controls.transferAmount.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Amount' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
                @if (makeAccountTransferForm.controls.transferAmount.hasError('min')) {
                  <mat-error>
                    {{ 'labels.inputs.Amount' | translate }} {{ 'labels.commons.mustBeAtLeast' | translate }} 0.01
                  </mat-error>
                }
                @if (makeAccountTransferForm.get('transferAmount')?.hasError('amountExceedsBalance')) {
                  <mat-error>
                    <fa-icon icon="exclamation-triangle" size="md"></fa-icon>
                    {{ 'errors.validation.msg.savingsproduct.insufficient.balance' | translate: { balance } }}
                  </mat-error>
                }
              </mat-form-field>
              <mat-form-field class="form-field description-field">
                <mat-label>{{ 'labels.inputs.Description' | translate }}</mat-label>
                <textarea
                  matInput
                  formControlName="transferDescription"
                  cdkTextareaAutosize
                  cdkAutosizeMinRows="2"
                  placeholder="{{ 'labels.text.EnterTransferDescription' | translate }}"
                  title="Transfer description"
                ></textarea>
                @if (makeAccountTransferForm.controls.transferDescription.hasError('required')) {
                  <mat-error>
                    {{ 'labels.inputs.Transfer Description' | translate }} {{ 'labels.commons.is' | translate }}
                    <strong>{{ 'labels.commons.required' | translate }}</strong>
                  </mat-error>
                }
              </mat-form-field>
            </div>
          </form>
        }
      </mat-card-content>
      @if (!isLoading && makeAccountTransferForm) {
        <mat-card-actions class="action-buttons">
          <button type="button" mat-raised-button [routerLink]="['../..']" class="cancel-button">
            {{ 'labels.buttons.Cancel' | translate }}
          </button>
          <ng-container *mifosxHasPermission="'CREATE_ACCOUNTTRANSFER'">
            @if (interbank && interbankTransferForm) {
              <button
                mat-raised-button
                color="primary"
                [disabled]="!makeAccountTransferForm.valid"
                (click)="submit()"
                class="primary-button"
              >
                {{ 'labels.buttons.Submit' | translate }}
              </button>
            }
            @if (!interbank) {
              <button
                mat-raised-button
                color="primary"
                [disabled]="!makeAccountTransferForm.valid"
                (click)="submit()"
                class="primary-button"
              >
                {{ 'labels.buttons.Submit' | translate }}
              </button>
            }
          </ng-container>
        </mat-card-actions>
      }
    </mat-card>
  }
</div>
