<div class="container mat-elevation-z8">
  <mat-card>
    @if (loanTransactionData !== null) {
      <form [formGroup]="reagingLoanForm" (ngSubmit)="submit()">
        <mat-card-content>
          <div class="layout-column">
            <mat-form-field>
              <mat-label>{{ 'labels.inputs.Number of Installments' | translate }}</mat-label>
              <input type="number" matInput required formControlName="numberOfInstallments" />
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{ 'labels.inputs.Frequency Number' | translate }}</mat-label>
              <input type="number" matInput required formControlName="frequencyNumber" />
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{ 'labels.inputs.Frequency Type' | translate }}</mat-label>
              <mat-select formControlName="frequencyType">
                @for (frequencyType of periodFrequencyOptions; track frequencyType) {
                  <mat-option [value]="frequencyType">
                    {{ frequencyType }}
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>
            <mat-form-field (click)="startDatePicker.open()">
              <mat-label>{{ 'labels.inputs.Start Date' | translate }}</mat-label>
              <input
                matInput
                [min]="minDate"
                [max]="maxDate"
                [matDatepicker]="startDatePicker"
                required
                formControlName="startDate"
              />
              <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #startDatePicker></mat-datepicker>
              @if (reagingLoanForm.controls.startDate.hasError('required')) {
                <mat-error>
                  {{ 'labels.inputs.Start Date' | translate }} {{ 'labels.commons.is' | translate }}
                  <strong>{{ 'labels.commons.required' | translate }}</strong>
                </mat-error>
              }
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{ 'labels.inputs.Interest Handling' | translate }}</mat-label>
              <mat-select formControlName="reAgeInterestHandling">
                @for (reAgeInterestHandlingOption of reAgeInterestHandlingOptions; track reAgeInterestHandlingOption) {
                  <mat-option [value]="reAgeInterestHandlingOption.id">
                    {{ reAgeInterestHandlingOption.value | translateKey: 'catalogs' }}
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{ 'labels.inputs.Reason' | translate }}</mat-label>
              <mat-select formControlName="reasonCodeValueId">
                @for (reAgeReasonOption of reAgeReasonOptions; track reAgeReasonOption) {
                  <mat-option [value]="reAgeReasonOption.id">
                    {{ reAgeReasonOption.name }}
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{ 'labels.inputs.External Id' | translate }}</mat-label>
              <input matInput formControlName="externalId" />
            </mat-form-field>
            <mat-form-field>
              <mat-label>{{ 'labels.inputs.Note' | translate }}</mat-label>
              <input matInput formControlName="note" />
            </mat-form-field>
            <div class="flex-fill">
              <span class="expandcollapsebutton m-l-10 m-t-5 m-b-5 flex-75" (click)="displayTransactionAmount()">
                <mat-slide-toggle>
                  <div>
                    <span class="m-l-10">{{ 'labels.inputs.Transaction Amount' | translate }}</span>
                  </div>
                </mat-slide-toggle>
              </span>
            </div>
            @if (addTransactionAmount) {
              <mifosx-input-amount
                [currency]="loanTransactionData.currency"
                [isRequired]="false"
                [inputFormControl]="reagingLoanForm.controls.transactionAmount"
                [inputLabel]="'Transaction Amount'"
                [minVal]="loanTransactionData.amount"
                [maxVal]="loanTransactionData.amount"
              >
              </mifosx-input-amount>
            }
          </div>
          <mat-card-actions class="layout-row align-center gap-5px responsive-column">
            <button type="button" mat-raised-button [routerLink]="['../../general']">
              {{ 'labels.buttons.Cancel' | translate }}
            </button>
            <button
              mat-raised-button
              color="primary"
              [disabled]="!reagingLoanForm.valid"
              *mifosxHasPermission="'REAGING_LOAN'"
            >
              {{ 'labels.buttons.Submit' | translate }}
            </button>
            <button
              type="button"
              mat-raised-button
              color="accent"
              [disabled]="!reagingLoanForm.valid"
              *mifosxHasPermission="'REAGING_LOAN'"
              (click)="preview()"
            >
              {{ 'labels.buttons.Preview' | translate }}
            </button>
          </mat-card-actions>
        </mat-card-content>
      </form>
    }
  </mat-card>
</div>
